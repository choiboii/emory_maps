<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">
    <script src = "https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src = "https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Geocoding</title>
</head>
<body>
    <div class = "container">
        <h2 id = "text-center">Enter Location: </h2>
        <form action="" id = "location-form">
            <input id = "location-input" placeholder = 'Enter a place' type="text" class = "form-control 
            form-control-lg">
            <br>
            <button type = "submit" class = "btn btn-primary btn-block" style="border-color: #212C65; background-color: #212C65;">Submit</button>
        </form>
        <div class = "card-block" id = "formatted-address"></div>
        <div class = "card-block" id = "address-components"></div>
        <div class = "card-block" id = "geometry"></div>
        <div class = "card-block" id = "place-name"></div>
    </div>
    <script>
        //call geocode
        //geocode();

        //get location form
        var locationForm = document.getElementById('location-form');

        //listen for submit
        locationForm.addEventListener('submit', geocode);
        locationForm.addEventListener('submit', initAutocomplete);


        function geocode(e) {
            //prevent actual submit
            e.preventDefault();

            var location = document.getElementById('location-input').value;
            
            axios.get("https://maps.googleapis.com/maps/api/geocode/json", {
                params: {
                    address: location,
                    key: "AIzaSyCsklehWRTLY54gug20dY1zByw0JosG-So"
                }
            })
            .then(function(response) {
                //log full response
                console.log(response);

                //formatted address
                var formattedAddress = response.data.results[0].formatted_address;
                var formattedAddressOutput = `
                    <ul class = "list-group">
                        <li class = "list-group-item"><strong>Address</strong>: ${formattedAddress}</li>
                        </ul>
                `;

                //address components
                var addressComponents = response.data.results[0].address_components;
                var addressComponentsOutput = '<ul class = "list-group">';
                /*
                for(var i = 0; i < addressComponents.length; i++) {
                    addressComponentsOutput += `
                    <li class = "list-group-item"><strong>${addressComponents[i].types[0]}</strong>: ${addressComponents[i].long_name}</li>
                    `;
                }
                */

                addressComponentsOutput += "</ul>"

                //geometry
                //formatted address
                var lat = response.data.results[0].geometry.location.lat;
                var lng = response.data.results[0].geometry.location.lng;
                var geometryOutput = `
                    <ul class = "list-group">
                        <li class = "list-group-item"><strong>Coordinates</strong>: (${lat}, ${lng}) </li>
                        </ul>
                `;

                //output to app
                document.getElementById(`formatted-address`).innerHTML = formattedAddressOutput;
                document.getElementById(`address-components`).innerHTML = addressComponentsOutput;
                document.getElementById(`geometry`).innerHTML = geometryOutput;

            })
            .catch(function(error){
                console.log(error);
            })
        }
/*
        function getPlaceDetails(e) {
            e.preventDefault();

            var location = document.getElementById('location-input').value;
            
            axios.get("https://maps.googleapis.com/maps/api/geocode/json", {
                params: {
                    address: location,
                    key: "AIzaSyCsklehWRTLY54gug20dY1zByw0JosG-So"
                }
            })
            .then(function(response) {
                //log full response
                console.log(response);

            var request = {
                placeId: response.data.results[0].placeId,
                field: ['name', 'formatted_phone_number', 'geometry']
            };

            service = new google.maps.places.PlacesService(map);
            var details = service.getDetails(request, callback);

            function callback(place, status) {
                if (status == google.maps.places.PlacesServiceStatus.OK) {
                createMarker(place);
                }
            }

            var placeDetailsOutput = `
            <ul class = "list-group">
                <li class = "list-group-item"><strong>ID</strong>: details.placeId </li>
                </ul>`;
            document.getElementById(`place-name`).innerHTML = placeDetailsOutput;
            })
        }
        */
        let autocomplete;
        function initAutocomplete() {
            autocomplete = new google.maps.places.Autocomplete(
                document.getElementById('location-input'),
                {
                    types: ['university', 'food'],
                    componentRestrictions: {'country': ['US']}, //improves predictions
                    fields: ['place_id', 'geometry', 'name']
                });

            autocomplete.addListener('submit', onPlaceChanged);

            function onPlaceChanged() {
                var place = autocomplete.getPlace();

                if(!place.geometry) {
                    //did not select a prediction
                    document.getElementById('autocomplete').placeholder = 'Enter a place';
                } else {
                    //display info about valid place
                    document.getElementById(`place-name`).innerHTML = `<ul class = "list-group">
                        <li class = "list-group-item"><strong>Address</strong>: hello</li>
                        </ul>
                `;
                    //geocode;
                    //getPlaceDetails;
                }
            }
            
        }


    </script>
    <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsklehWRTLY54gug20dY1zByw0JosG-So&callback=initAutocomplete&v=weekly&libraries=places"
    async defer
    ></script>
</body>
</html>